(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{344:function(e,t,a){"use strict";a.r(t);var i=a(3),s=a(1),n=a(4);i.d.add(s.R,s.P,s.L,s.M,s.J,s.c,n.g,s.Bb);var o={components:{ModalUpload:function(){return a.e(74).then(a.bind(null,381))}},props:["user"],data:function(){return{dropFiles:[],rcas:Array,isPaginated:!0,isPaginationSimple:!1,paginationPosition:"bottom",defaultSortDirection:"asc",sortIcon:"arrow-up",sortIconSize:"is-small",currentPage:1,perPage:10,edit:!1,isUploadModalActive:!1}},computed:{canUpload:function(){return this.rcas.can&&this.rcas.can.upload},canDelete:function(){return this.rcas.can&&this.rcas.can.delete}},created:function(){this.$eventBus.$on("reload-rcas",this.getRCAs)},mounted:function(){this.getRCAs()},methods:{getRCAs:function(){var e=this;axios.get("/api/rcas").then((function(t){console.log(t.data),e.rcas=t.data}))},submit:function(){var e=this;this.dropFiles.forEach((function(t){return e.submitForm(t)}))},submitForm:function(e){var t=this,a={headers:{"content-type":"multipart/form-data","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}},i=new FormData;i.append("file",e);try{axios.post("/api/rcas",i,a).then((function(e){t.getRCAs()}))}catch(e){console.log(e)}},faFile:function(e){return{icon:"pdf"==e?"file-pdf":"jpg"==e||"png"==e||"jpeg"==e?"file-image":"xls"==e||"xlsx"==e?"file-excel":"file",type:"pdf"==e?"has-text-info":"jpg"==e||"png"==e||"jpeg"==e?"has-text-warning":"xls"==e||"xlsx"==e?"has-text-success":"has-text-primary"}},openFile:function(e){"pdf"==e.extension||"jpg"==e.extension||"png"==e.extension||"jpeg"==e.extension?window.open("/storage/"+e.route,"_blank"):this.readFile(e)},readFile:function(e){var t=this;this.isLoading=!0;var a={route:e.route,mime:e.mime};axios.get("/api/viewFile",{params:a,responseType:"arraybuffer"}).then((function(a){console.log(a);var i=new Blob([a.data],{type:e.mime});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(newBlob);else{var s=window.URL.createObjectURL(i),n=document.createElement("a");n.href=s,n.target="_self",n.open=e.basename,n.click(),t.isLoading=!1,t.$buefy.toast.open({message:"El archivo se ha descargado exitosamente.",type:"is-success",duration:5e3})}})).catch((function(e){console.log(e),t.isLoading=!1,t.$buefy.toast.open({message:"Ha ocurrido un error. Favor contactar al administrador",type:"is-danger",duration:5e3})}))},confirmDelete:function(e){var t=this;this.$buefy.dialog.confirm({message:"Desea eliminar este archivo?",type:"is-danger",onConfirm:function(){axios.delete("/api/files/".concat(e.id)).then((function(e){console.log(e),t.getRCAs()}))}})}},beforeDestroy:function(){this.$eventBus.$off("reload-rcas")}},r=a(0),l=Object(r.a)(o,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tile is-child box"},[a("div",{staticClass:"is-pulled-right"},[e.canUpload?a("span",{},[a("button",{staticClass:"button",on:{click:function(t){e.isUploadModalActive=!0}}},[e._v("Subir archivos")])]):e._e(),e._v(" "),e.canDelete?a("span",{},[a("button",{staticClass:"button",class:e.edit&&"is-danger",on:{click:function(t){e.edit=!e.edit}}},[e._v("Editar")])]):e._e()]),e._v(" "),a("div",{staticClass:"title is-size-4"},[e._v("RCAs")]),e._v(" "),a("b-table",{attrs:{data:e.rcas.files,paginated:e.isPaginated,"per-page":e.perPage,"current-page":e.currentPage,"pagination-simple":e.isPaginationSimple,"pagination-position":e.paginationPosition,"default-sort-direction":e.defaultSortDirection,"sort-icon":e.sortIcon,"sort-icon-size":e.sortIconSize,"pagination-size":"is-small","default-sort":"user.first_name","aria-next-label":"Next page","aria-previous-label":"Previous page","aria-page-label":"Page","aria-current-label":"Current page"},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}},[a("b-table-column",{staticClass:"is-size-6",attrs:{width:"60%",field:"basename",label:"Archivo",sortable:"",searchable:""},scopedSlots:e._u([{key:"searchable",fn:function(t){return[a("b-input",{model:{value:t.filters[t.column.field],callback:function(a){e.$set(t.filters,t.column.field,a)},expression:"props.filters[props.column.field]"}})]}},{key:"header",fn:function(t){var i=t.column;return[a("b-tooltip",{staticClass:"is-size-6",attrs:{label:i.label,"append-to-body":""}},[e._v("\n                    "+e._s(i.label)+"\n                ")])]}},{key:"default",fn:function(t){return[a("a",{staticClass:"columns"},[a("div",{staticClass:"column is-1"},[a("font-awesome-icon",{class:e.faFile(t.row.extension).type,attrs:{icon:["fas",e.faFile(t.row.extension).icon]}})],1),e._v(" "),a("div",{staticClass:"column"},[a("div",{staticClass:"is-size-6",on:{click:function(a){return e.openFile(t.row)}}},[e._v(e._s(t.row.basename))]),e._v(" "),a("div",{staticClass:"is-size-7 has-text-dark"},[e._v(e._s(t.row.size/1e3)+" kb")])])])]}}])}),e._v(" "),a("b-table-column",{staticClass:"is-size-6",attrs:{width:"",field:"site.nem_site",label:"PoP",sortable:"",searchable:""},scopedSlots:e._u([{key:"searchable",fn:function(t){return[a("b-input",{model:{value:t.filters[t.column.field],callback:function(a){e.$set(t.filters,t.column.field,a)},expression:"props.filters[props.column.field]"}})]}},{key:"header",fn:function(t){var i=t.column;return[a("b-tooltip",{staticClass:"is-size-6",attrs:{label:i.label,"append-to-body":""}},[e._v("\n                    "+e._s(i.label)+"\n                ")])]}},{key:"default",fn:function(t){return[t.row.site||t.row.pop?a("div",{staticClass:"has-text-right"},[a("div",{staticClass:"is-size-7"},[e._v(e._s(t.row.site?t.row.site.nem_site:t.row.pop?t.row.pop.sites[0].nem_site:""))]),e._v(" "),a("router-link",{staticClass:"is-size-7",attrs:{to:"/pop/"+(t.row.site?t.row.site.pop_id:t.row.pop?t.row.pop.id:""),target:"_blank"}},[a("div",{staticClass:"is-size-6"},[e._v(e._s(t.row.site?t.row.site.pop.nombre:t.row.pop?t.row.pop.sites[0].nombre:""))])])],1):e._e(),e._v(" "),t.row.site||t.row.pop?e._e():a("div",{staticClass:"has-text-right is-size-6"},[e._v("RCA GENERAL")])]}}])}),e._v(" "),e.canDelete&&e.edit?a("b-table-column",{attrs:{field:"id",label:"",width:"10",numeric:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("button",{staticClass:"button is-small",on:{click:function(a){return e.confirmDelete(t.row)}}},[a("font-awesome-icon",{staticClass:"is-size-7 has-text-danger",attrs:{icon:["far","trash-alt"]}})],1)]}}],null,!1,3709482748)}):e._e(),e._v(" "),a("template",{slot:"empty"},[a("section",{staticClass:"section"},[a("div",{staticClass:"content has-text-grey has-text-centered"},[a("p",[a("b-icon",{attrs:{icon:"emoticon-sad",size:"is-large"}})],1),e._v(" "),a("p",[e._v("No hay archivos.")])])])])],2),e._v(" "),e.rcas.can&&e.rcas.can.upload?a("b-modal",{attrs:{active:e.isUploadModalActive,"has-modal-card":"","trap-focus":"","aria-role":"dialog","aria-modal":""},on:{"update:active":function(t){e.isUploadModalActive=t}}},[a("modal-upload",{attrs:{user:e.user}})],1):e._e()],1)}),[],!1,null,null,null);t.default=l.exports}}]);