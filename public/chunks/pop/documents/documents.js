(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{335:function(e,t,i){"use strict";i.r(t);var a=i(3),s=i(1),o=i(4);function n(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return l(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}a.d.add(s.R,s.P,s.L,s.M,s.J,s.c,o.g,s.Eb);var r={components:{ModalUpload:function(){return i.e(116).then(i.bind(null,373))},ModalNewFolder:function(){return i.e(115).then(i.bind(null,374))}},props:["user","pop","bodyBackground","boxBackground","primaryText","secondaryText"],data:function(){return{folders:[],files:[],photos:[],activeTab:0,showCam:!0,multiline:!0,isLoading:!1,load:0,canCreateFolder:!1,canDeleteFolder:!1,canUploadFile:!1,canDeleteFile:!1,edit:!1,isUploadModalActive:!1,isNewFolderModalActive:!1,currentFolderView:{id:null,parent_id:null},parentViewId:null,bread:"",gallery:!1,al:{hasGrayscale:!0,itemsToShow:2,breakpoints:{768:{hasGrayscale:!1,itemsToShow:4},960:{hasGrayscale:!0,itemsToShow:6}}}}},created:function(){this.$eventBus.$on("reload-files",this.getFiles)},mounted:function(){this.setFolderTab(),this.getFolders(),this.getFiles()},computed:{folderTab:function(){return this.baseTabs[this.activeTab]},baseTabs:function(){return[{id:1,label:"Informes",content:"Informes: Lorem ipsum dolor sit amet.",displayed:!0},{id:2,label:"Documentos",content:"Documentos: Lorem ipsum dolor sit amet.",displayed:!0},{id:3,label:"Fotos",content:"Fotos: Lorem ipsum dolor sit amet.",displayed:!0},{id:4,label:"Construcción",content:"Construcción: Lorem ipsum dolor sit amet.",displayed:!0},{id:5,label:"Obras Civiles",content:"Obras Civiles: Lorem ipsum dolor sit amet.",displayed:!0},{id:6,label:"CAM",content:"CAM: Lorem ipsum dolor sit amet.",displayed:!0},{id:7,label:"Levantamientos Ingeniería",content:"Levantamientos Ingeniería: Lorem ipsum dolor sit amet.",displayed:!0},{id:8,label:"Gestión Ambiental",content:"Gestión Ambiental: Lorem ipsum dolor sit amet.",displayed:!0}]},tabs:function(){var e=n(this.baseTabs);return e},noFiles:function(){return!this.folders.length&&!this.files.length&&!this.photos.length}},watch:{isNewFolderModalActive:function(e){0==e&&this.getFolders()}},methods:{setFolderTab:function(){this.bread="",this.currentFolderView.id=null,this.getFolders(),this.getFiles()},selected:function(e){this.setBreadcrum(e.name),this.parentViewId=this.currentFolderView.id,this.currentFolderView=e,this.getFolders(),this.getFiles()},getFolders:function(){var e=this,t={folder_name:this.folderTab.label,folder_id:this.currentFolderView.id,pop_id:this.pop.id};axios.get("/api/folders/".concat(this.pop.id),{params:t}).then((function(t){e.folders=t.data.folders,e.canCreateFolder=t.data.can.create,e.canDeleteFolder=t.data.can.delete})),axios.get("/api/currentFolder",{params:t}).then((function(t){e.currentFolderView=t.data.folder}))},getFiles:function(){var e=this,t={folder_name:this.folderTab.label,folder_id:this.currentFolderView.id};this.files=[],this.photos=[],axios.get("/api/files/".concat(this.pop.id),{params:t}).then((function(t){Object.keys(t.data.files).forEach((function(i){var a=t.data.files[i];"jpg"==a.extension.toLowerCase()||"png"==a.extension.toLowerCase()||"jpeg"==a.extension.toLowerCase()||"tiff"==a.extension.toLowerCase()?(a.image="/storage/"+a.route,e.photos.push(a)):e.files.push(a)})),e.canUploadFile=t.data.can.upload,e.canDeleteFile=t.data.can.delete}))},faFile:function(e){var t="file",i="has-text-primary";switch(e.toLowerCase()){case"pdf":t="file-pdf",i="has-text-info";break;case"jpg":case"jpeg":case"png":case"tiff":t="file-image",i="has-text-warning";break;case"xls":case"xlsx":t="file-excel",i="has-text-success";break;default:t="file",i="has-text-primary"}return{icon:t,type:i}},openFile:function(e){"pdf"==e.extension.toLowerCase()||"jpg"==e.extension.toLowerCase()||"png"==e.extension.toLowerCase()||"jpeg"==e.extension.toLowerCase()?window.open("/storage/"+e.route,"_blank"):this.readFile(e)},readFile:function(e){var t=this;this.isLoading=!0;var i={route:e.route,mime:e.mime};axios.get("/api/viewFile",{params:i,responseType:"arraybuffer"}).then((function(i){var a=new Blob([i.data],{type:e.mime}),s=window.URL.createObjectURL(a);if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(newBlob);else{var o=document.createElement("a");o.href=s,o.open=e.basename,o.target="_self",o.click(),setTimeout((function(){window.URL.revokeObjectURL(s)}),100),t.isLoading=!1,t.$buefy.toast.open({message:"El archivo se ha descargado exitosamente.",type:"is-success",duration:5e3})}})).catch((function(e){console.log(e),t.isLoading=!1,t.$buefy.toast.open({message:"Ha ocurrido un error. Favor contactar al administrador",type:"is-danger",duration:5e3})}))},confirmDeleteFolder:function(e){var t=this;this.$buefy.dialog.confirm({message:"Desea eliminar esta carpeta?",type:"is-danger",onConfirm:function(){var i={user_id:t.user.id,pop_id:t.pop.id};axios.delete("/api/folders/".concat(e.id),{params:i}).then((function(e){t.getFolders(),t.$eventBus.$emit("folder-deleted")}))}})},setBreadcrum:function(e){""==this.bread?this.bread=e:this.bread=this.bread+" / "+e},backOne:function(){var e=this.bread.split("/");e.pop();this.bread="";for(var t=0;t<e.length;t++)this.bread=""==this.bread?e[t]:this.bread+"/"+e[t];this.currentFolderView.id=this.currentFolderView.parent_id,this.getFolders(),this.getFiles()},confirmDeleteFile:function(e){var t=this;this.$buefy.dialog.confirm({message:"Desea eliminar este archivo?",type:"is-danger",onConfirm:function(){axios.delete("/api/files/".concat(e.id)).then((function(e){t.getFiles(),t.$eventBus.$emit("file-deleted")}))}})},makeDroneFootage:function(e){var t=this;this.$buefy.dialog.confirm({message:'Desea agregar este video como una captura de Drone?\n\rEl video aparecerá en la sección "Drone"',type:"is-link",onConfirm:function(){var i={pop_id:t.pop.id,file_id:e.id};axios.put("/api/addDrone",i).then((function(e){console.log(e),t.$eventBus.$emit("drone-added"),t.$buefy.toast.open({message:"Video agregado con exito",type:"is-success",duration:2e3})}))}})},switchGallery:function(e){return this.gallery=e,e?document.documentElement.classList.add("is-clipped"):document.documentElement.classList.remove("is-clipped")},isVideo:function(e){return"mov"==e.extension.toLowerCase()||"mp4"==e.extension.toLowerCase()||"m4v"==e.extension.toLowerCase()||"avi"==e.extension.toLowerCase()}},beforeDestroy:function(){this.$eventBus.$off("reload-files")}},c=i(0),d=Object(c.a)(r,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{},[e._m(0),e._v(" "),i("div",{staticClass:"columns"},[i("div",{staticClass:"column"},[i("div",{staticClass:"box"},[i("b-tabs",{staticStyle:{"margin-bottom":"0px"},attrs:{multiline:e.multiline,position:"is-centered"},on:{input:function(t){return e.setFolderTab()}},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[e._l(e.tabs,(function(t,a){return[t.displayed?i("b-tab-item",{key:a,attrs:{label:t.label}}):e._e()]}))],2),e._v(" "),i("div",{staticClass:"columns",staticStyle:{"padding-bottom":"20px","padding-left":"24px"}},[i("div",{staticClass:"column has-text-left"},[i("span",[e.bread?i("a",{on:{click:e.backOne}},[i("font-awesome-icon",{staticClass:"is-link",staticStyle:{"margin-bottom":"-4px"},attrs:{icon:["fas","angle-left"],size:"2x"}})],1):e._e(),e._v(" "),i("span",{staticClass:"is-size-6",staticStyle:{"margin-bottom":"25px"}},[e._v(" "+e._s(e.bread))])])]),e._v(" "),i("div",{staticClass:"column has-text-right"},[e.canUploadFile?i("span",{},[i("button",{staticClass:"button",on:{click:function(t){e.isUploadModalActive=!0}}},[e._v("Subir archivos")])]):e._e(),e._v(" "),e.canUploadFile?i("span",{},[i("button",{staticClass:"button",on:{click:function(t){e.isNewFolderModalActive=!0}}},[e._v("Nueva Carpeta")])]):e._e(),e._v(" "),e.canUploadFile?i("span",{},[i("button",{staticClass:"button",class:e.edit&&"is-danger",on:{click:function(t){e.edit=!e.edit}}},[e._v("Editar")])]):e._e()])]),e._v(" "),e.edit?e._e():i("div",{staticClass:"columns is-multiline"},[e._l(e.folders,(function(t){return i("div",{key:t.id,staticClass:"column is-3 tile is-parent"},[i("a",{staticClass:"box tile is-child",staticStyle:{position:"relative"},on:{click:function(i){return e.selected(t)}}},[i("font-awesome-icon",{staticClass:"has-text-smart",staticStyle:{"padding-bottom":"5px"},attrs:{icon:["fas","folder-open"],size:"3x"}}),e._v(" "),i("div",{staticClass:"is-size-6 has-text-weight-bold"},[e._v(e._s(""!=e.bread?t.name:t.site&&t.site.nem_site))])],1)])})),e._v(" "),e._l(e.files,(function(t){return i("div",{key:t.id,staticClass:"column is-3 tile is-parent"},[i("a",{staticClass:"box tile is-child",staticStyle:{position:"relative"},on:{click:function(i){e.openFile(t),e.load=t.id}}},[i("font-awesome-icon",{class:e.faFile(t.extension).type,staticStyle:{"padding-bottom":"5px"},attrs:{icon:["fas",e.faFile(t.extension).icon],size:"3x"}}),e._v(" "),i("div",{staticClass:"is-size-7"},[e._v(e._s(t.basename))]),e._v(" "),e.load==t.id?i("b-loading",{attrs:{"is-full-page":!1,active:e.isLoading,"can-cancel":!0},on:{"update:active":function(t){e.isLoading=t}}}):e._e()],1)])}))],2),e._v(" "),e.edit?i("div",{staticClass:"columns is-multiline"},[e._l(e.folders,(function(t){return i("div",{key:t.id,staticClass:"column is-3 tile is-parent"},[i("div",{staticClass:"box tile is-child",staticStyle:{position:"relative"}},[i("a",{staticClass:"is-pulled-right has-text-danger",on:{click:function(i){return e.confirmDeleteFolder(t)}}},[i("font-awesome-icon",{staticStyle:{"padding-bottom":"5px"},attrs:{icon:["far","trash-alt"],size:"2x"}})],1),e._v(" "),i("font-awesome-icon",{staticClass:"has-text-smart",staticStyle:{"padding-bottom":"5px"},attrs:{icon:["fas","folder-open"],size:"3x"}}),e._v(" "),i("div",{staticClass:"is-size-6 has-text-weight-bold"},[e._v(e._s(""!=e.bread?t.name:t.site&&t.site.nem_site))])],1)])})),e._v(" "),e._l(e.files,(function(t){return i("div",{key:t.id,staticClass:"column is-3 tile is-parent"},[i("div",{staticClass:"box tile is-child",staticStyle:{position:"relative"}},[i("a",{staticClass:"is-pulled-right has-text-danger",on:{click:function(i){return e.confirmDeleteFile(t)}}},[i("font-awesome-icon",{staticStyle:{"padding-bottom":"5px"},attrs:{icon:["far","trash-alt"],size:"1x"}})],1),e._v(" "),e.isVideo(t)?i("a",{staticClass:"is-pulled-right has-text-link",on:{click:function(i){return e.makeDroneFootage(t)}}},[i("font-awesome-icon",{staticStyle:{"padding-bottom":"5px"},attrs:{icon:["fas","video"],size:"1x"}})],1):e._e(),e._v(" "),i("font-awesome-icon",{class:e.faFile(t.extension).type,staticStyle:{"padding-bottom":"5px"},attrs:{icon:["fas",e.faFile(t.extension).icon],size:"3x"}}),e._v(" "),i("div",{staticClass:"is-size-7"},[e._v(e._s(t.basename))]),e._v(" "),e.load==t.id?i("b-loading",{attrs:{"is-full-page":!1,active:e.isLoading,"can-cancel":!0},on:{"update:active":function(t){e.isLoading=t}}}):e._e()],1)])}))],2):e._e(),e._v(" "),e.photos.length?i("div",[i("hr"),e._v(" "),e._m(1),e._v(" "),i("div",{staticClass:"container has-background-light"},[i("b-carousel",{attrs:{"icon-pack":"fas","indicator-custom":"",autoplay:!1,"with-carousel-list":"",indicator:!1,overlay:e.gallery},on:{click:function(t){return e.switchGallery(!0)}},scopedSlots:e._u([{key:"list",fn:function(t){return[i("b-carousel-list",e._b({attrs:{data:e.photos,"as-indicator":"","has-drag":!0},on:{switch:function(e){return t.switch(e,!1)}},model:{value:t.active,callback:function(i){e.$set(t,"active",i)},expression:"props.active"}},"b-carousel-list",e.al,!1))]}}],null,!1,3179916388)},[e._l(e.photos,(function(e,t){return i("b-carousel-item",{key:t,staticClass:"has-text-centered"},[i("figure",{staticClass:"image"},[i("img",{staticStyle:{"max-height":"800px",width:"auto",display:"block"},attrs:{src:e.image}})])])})),e._v(" "),e.gallery?i("span",{staticClass:"modal-close is-large",on:{click:function(t){return e.switchGallery(!1)}}}):e._e(),e._v(" "),e._v(" "),i("template",{slot:"overlay"},[i("div",{staticClass:"has-text-centered has-text-white"},[e._v("\n                                    Hello i'am overlay!\n                                ")])])],2)],1)]):e._e(),e._v(" "),e.noFiles?i("section",{staticClass:"section container"},[i("div",{staticClass:"has-text-weight-normal"},[e._v("No hay archivos en esta sección.")])]):e._e()],1)])]),e._v(" "),i("b-modal",{attrs:{active:e.isUploadModalActive,"has-modal-card":"","trap-focus":"","aria-role":"dialog","aria-modal":""},on:{"update:active":function(t){e.isUploadModalActive=t}}},[i("modal-upload",{attrs:{folder_id:e.currentFolderView.id,folderTab:e.folderTab,pop:e.pop,user:e.user}})],1),e._v(" "),i("b-modal",{attrs:{active:e.isNewFolderModalActive,"has-modal-card":"","trap-focus":"","aria-role":"dialog","aria-modal":""},on:{"update:active":function(t){e.isNewFolderModalActive=t}}},[i("modal-new-folder",{attrs:{folder_id:e.currentFolderView.id,folderTab:e.folderTab,pop:e.pop,user:e.user}})],1)],1)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"columns"},[t("div",{staticClass:"column has-text-weight-semibold has-text-dark is-size-3 has-text-left"},[this._v("Documentos")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"block"},[t("div",{staticClass:"is-size-5 has-text-weight-semibold"},[this._v("Visor de fotos")])])}],!1,null,null,null);t.default=d.exports}}]);